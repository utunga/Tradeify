<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Tradeify"
      height="600" scrolling="true">
    <Require feature="dynamic-height"/>
    <Require feature="opensocial-0.7" />
  </ModulePrefs>
  <!-- Content section for profile view omitted -->
  <Content type="html" view="canvas">
    <![CDATA[
 

<link href="http://tradeify.org/osocial/tradeify_widget.css" rel="stylesheet" type="text/css" media="all" />
<link href="http://tradeify.org/css/ooooby_theme/jquery-ui-1.7.2.custom.css" rel="stylesheet" type="text/css" media="all" />
<link href="http://tradeify.org/css/ooooby_theme/Pager.css" rel="stylesheet" type="text/css" media="all" />
<input type="text" class="ui-state-default ui-corner-all" name="searchdata" id="searchdata"/>
<button class="ui-button ui-state-default ui-corner-all" onclick="queryServer()">search</button>

<div id="current_tags"><br/>
    </div>
    <div id="results">
        <ul>
            <li><a href="#results-1">List</a></li>
            <li><a href="#results-2">Map</a></li>
        </ul>
        <div id="results-1" style="padding-bottom: 30px;">
            <span class="template" id="offer_template">
                <div class="offer" style="padding-bottom: 20px;">
                    <a href="#" class="offer_overall"><span><a href="user_uri" class="avatar" target="_top">
                        <img src="user_thumb" width="16" height="16" alt="username" /></a> <a href="user_uri" target="_top"
                            class="username"></a>
                        <p class="msg">
                            <span class="text"></span>
                            <br />
                            <span class="tags"><span class="tag"><a href="#" onclick=""></a>, </span></span>
                        </p>
                        <div class="meta">
                            <a class="when" href="source_uri">Today, 10:50 am</a>
                        </div>
                    </span></a>
                </div>
            </span>
            <div id="pager"></div>
        </div>
        <div id="results-2">
            <div id="offer_map" style="width: 100%; height: 100%; height:500px">
            </div>
        </div>
    </div>
    </div>

<h4>Post Your Own</h4>
<div id="post_your_own_form" class="ui-widget">

	<div class="tooltip"></div> 
    
    <div class="rawMessage">	
      <fieldset>
        <legend>Your message</legend>	
        <textarea title="" cols="42" rows="6" onkeyup="message_keyup()" name="message" class="ui-state-default ui-corner-all" id="message_to_send"></textarea>
        <button class="send_message ui-button ui-state-default ui-corner-all" >Post</button>
        <a class=message_details>
        <a class="location_detail status">
        <a>Location</a>
        </a>
        <a class="currency_detail status" >
        <a>Method of Trade</a>
        </a>
        <a class="group_detail status">
        <a>Group</a>
        </a>        
        </a>
       </fieldset>
    </div>
     
    <fieldset id="by_parts" class="ui-corner-all">
        <legend>Or... use this form</legend>
        <div class="offerPart">
            <label for="offer">I am offering ... </label>
            <textarea tabindex="0" cols="42" rows="3" type="text" name="offer" class="ui-state-default ui-corner-all" id="offer" ></textarea>
        </div>
        
       <div class="currency">
            <label for="for" class="desc"> for </label>
            <div id="currency_tags"></div>
        </div>
        
        <div class="location">
            <label for="location"> in </label>
            <input type="text" class="ui-state-default ui-corner-all" tabindex="1" name="location" id="location"/>
            <div id="map_canvas" ></div> <!--map goes here -->
            <div class="infobox"></div>
              <!--  <div class="example"> e.g. &quot;in L:Wellington, NZ&quot; (click to change)</div>-->
        </div>
        
      
        <div class="until">  
            <label for="until" class="desc"> until </label>
            <input type="text" name="until" id="until" class="ui-state-default ui-corner-all" />
        </div>
                    
        <div class="tags" style="width: 430px;">
            <label> Tags </label>
            <ul id="selected_tags">
                <li><a href="#" class="tag"></a></li>
            </ul>
            <blockquote>
                <h4>Suggested Tags (click to select)</h4> 
                <div id="suggested_tags">
                    <span class="template">
                        <ul class="select_tag_container">
                            <li><a href="#" class="tag"></a></li>
                        </ul>
                    </span>
                </div>
                <h4>Or type to add more</h4> 
                <input id="tags" name="tags" onkeyup="timeoutKeyChange()" class="ui-state-default ui-corner-all" tabindex="8" maxlength="255" style="width: 360px;"/>
            </blockquote>
        
        </div>
        
        <div class="thumbnail">
            <label for="picture_thumbnail"> Link to picture? </label>
            <input type="text" tabindex="8" maxlength="255" class="ui-state-default ui-corner-all" name="picture" id="picture" >
        </div>
        
        <div>
          <button type="button" class="send_message ui-button ui-state-default ui-corner-all">Post</button>
<!--            <button name="cancel" class="close ui-priority-secondary ui-corner-all" value="cancel" >cancel</button>
            <button name="submit" class="ui-priority-primary ui-corner-all" value="done" >done</button>	-->
        </div>
    </fieldset>
</div>
        <div id="map_popup" style="padding-bottom: 30px;">
            <span class="map_template" id="map_template">
                <div class="map_offer" style="padding-bottom: 20px;">
                    <a href="#" class="map_offer_overall"><span><a href="user_uri" class="map_avatar" target="_top">
                        <img src="map_user_thumb" width="16" height="16" alt="username" /></a> <a href="map_user_uri" target="_top"
                            class="map_username"></a>
                        <p class="map_msg">
                            <span class="map_text"></span>
                            <br />
                            <span class="map_tags"><span class="map_tag"><a href="#" onclick=""></a>, </span></span>
                        </p>
                        <div class="meta">
                            <a class="map_when" href="source_uri">Today, 10:50 am</a>
                        </div>
                    </span></a>
                </div>
            </span>
            <div id="pager"></div>
        </div>

<!--
<div class="regular" id="main">

<div id="myform">
  <textarea type="text" class="ui-state-disabled" name="message" id="message_to_send"></textarea>
  <button type="button" class="send_message ui-button ui-state-default ui-corner-all" >Submit</button>
</div>
</div>-->

<!--[if lt IE 7]>
<script src="http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js" type="text/javascript"></script>
<![endif]-->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
<!--OOOOBY.NING.ORG GOOGLE API KEY = ABQIAAAABEpdHyPr3QztCREcH5edthQJninID-M6PHkd65PL9JwO4W5uJxR_4_SFIiW5EiCw9BgVYD7J-NQ32w -->
<!-- google maps API v3 doesn't need an API key! -->
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript" src="http://tradeify.org/js/jquery-ui-1.7.2.custom.min.js"></script>
<!--
<script type="text/javascript" src="http://tradeify.org/js/jquery.tools.min.js"></script>
-->
<script type="text/javascript" src="http://tradeify.org/js/pure_packed_v2.js"></script>
<script type="text/javascript" src="http://tradeify.org/js/tag_support.js"></script>
<script type="text/javascript" src="http://tradeify.org/osocial/tradeify_widget.js"></script>
<script type="text/javascript" src="http://tradeify.org/osocial/opensocial_wrapper.js"></script>
<script type="text/javascript" src="http://tradeify.org/osocial/widget_support.js"></script>
<script type="text/javascript" src="http://tradeify.org/js/quickpager.jquery.js"></script>
<script type="text/javascript" src="http://tradeify.org/js/jquery.pager.js"></script>
<script type="text/javascript">

var currency_tags;
var current_tags;
var main_widget;
        $(function() {
            //alert("blah");
            //$("#results").tabs();
            /*$("#results").tabs({
                //event: 'mouseover'
                fx: { height: 'toggle', opacity: 'toggle' },
                show: function(event, ui) {
                    if (ui.panel.id == "results-2") {
                        $(ui.panel).css("height", "100%");
                        initialize();
                        google.maps.event.trigger(map, 'resize');
                        // map.checkResize();
                        
                    }
                }
            });*/
        });

$(document).ready(function() {
            main_widget = new TradeifyWidget("#results-1", "#current_tags");
            //$("#results").tabs();

    // adjusts height in ning, does nothing in test
    container.adjustHeight(3000);
	update_tags(); //preload some tags
	
	$(".offer tags tag").click(function() {								
	    var tag = current_tags.add_tag(this.text);
		    main_widget.update_offers();	
		    return false;	
	    });
    $("#by_parts input").keyup(update_offer);
	$("#by_parts textarea").keyup(update_offer);
	$("#by_parts input").change(update_offer);

	currency_tags = new Tags("#currency_tags");
  currency_tags.add_tag("free", "type", false);
	currency_tags.add_tag("barter", "type",  false);
	currency_tags.add_tag("swap", "type", false);
	currency_tags.add_tag("nzd", "type", false);
	currency_tags.tag_click( function() {
		var tag = currency_tags.find_tag($(this).text().replace("\n",""));
		tag.active = !tag.active;
		update_offer();	
		return false;	
	});

	current_tags = new Tags();
	current_tags.tag_click( function() {
		current_tags.remove_tag($(this).text());
		main_widget.update_offers();	
		return false;	
	});
	current_tags.target_selector="#current_tags";
	current_tags.add_fixed_tag("ooooby", "group", false);
  setTimeout(main_widget.update_offers,300);
	
	$("#post_your_own_form #until").datepicker(
			{minDate:0,
			 dateFormat: "dd M yy",
			 constrainInput: true,
			 showOn: "focus"
			 });
	
    $(".send_message").click(function() {
        var message=$("#message_to_send").val();
        container.post_message(message, function(response_data) {
            console.log("post_message result:" + response_data);
            alert("message posted");
            main_widget.update_offers();
            var params = {};
            params[opensocial.Activity.Field.TITLE] = message;
            var activity = opensocial.newActivity(params);
            /*"If the activity is of high importance, it will be created even if this requires asking the user for permission. 
            This may cause the container to open a user flow which may navigate away from your gagdet. 
            If the activity is of low importance, it will not be created if the user has not given permission for the current app to create activities.
            With this priority, the requestCreateActivity call will never open a user flow"*/
            opensocial.requestCreateActivity(activity, opensocial.CreateActivityPriority.LOW);
        });
        // how long to wait?
       
     });
	/*
	var triggers = $(".open_post").overlay({
	
		// some expose tweaks suitable for modal dialogs
		zIndex: 9998,
		closeOnClick	: false,
		expose: {
			zIndex: 9997,
			color: '#333',
			loadSpeed: 200,
			opacity: 0.9,
			closeOnClick: false
		}
	});
	*/
	$("#post_your_own_form form").submit(function(e) {
	
		// close the overlay
		triggers.overlay().close();
	
		// get user input
		var input = $(".rawMessage #message_to_send", this).val();
	
		// do something with the answer
		//triggers.eq(1).html(input);
		$("#message_to_send").val(input);
	
		// do not submit the form
		return e.preventDefault();
	});
  //parse offer just in case there is infromation already there
    parse_offer(); 
    // select all desired input fields and attach tooltips to them 
    /*$("#post_your_own_form :input").tooltip({ 
     
        place tooltip on the right edge 
        position: "center below", 
     
        a little tweaking of the position 
        offset: [-2, 10], 
     
        use the built-in fadeIn/fadeOut effect 
        effect: "fade", 
     
        custom opacity setting 
        opacity: 0.7, 
     
        use this single tooltip element 
        tip: '.tooltip' 
     
    });*/
	
	//$("#post_your_own_form").hide();

	
});
</script>
</div>
</div>
    ]]>
  </Content>
</Module>
